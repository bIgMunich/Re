@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<!DOCTYPE html>
<html>
<head>
    <title> 部门</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <script src="~/Content/zTree-zTree_v3-master/zTree_v3/js/jquery-1.4.4.min.js"></script>
    <link href="~/Content/zTree-zTree_v3-master/zTree_v3/css/zTreeStyle/zTreeStyle.css" rel="stylesheet" />
    <script src="~/Content/zTree-zTree_v3-master/zTree_v3/js/jquery.ztree.core-3.5.js"></script>
    <script src="~/Content/zTree-zTree_v3-master/zTree_v3/js/jquery.ztree.excheck-3.5.js"></script>
    <script src="~/Content/zTree-zTree_v3-master/zTree_v3/js/jquery.ztree.exedit.js"></script>
    <link href="~/Content/zTree-zTree_v3-master/zTree_v3/css/demo.css" rel="stylesheet" />
    <script type="text/javascript">
		<!--
        var setting = {
            view: {
                addHoverDom: addHoverDom,
                selectedMulti: false
            },
            edit: {
                enable: true,
                editNameSelectAll: true,
                showRemoveBtn:false,
                showRenameBtn: true
            },
            data: {
                simpleData: {
                    enable: true
                }
            },
            callback: {
                beforeDrag: beforeDrag,
                beforeEditName: beforeEditName,
                onRename: onRename
            }
        };


        function getData() {
            var zNodes = "";
            $.ajax({
                url: "/SysDept/GetTreeTest",
                async: false,
                type: "post",
                success: function (json) {
                    zNodes = json;
                }
            });
            return zNodes;
        }

        var log, className = "dark";
        function beforeDrag(treeId, treeNodes) {
            return false;
        }
        function beforeEditName(treeId, treeNode) {
            className = (className === "dark" ? "" : "dark");
            editWindow(treeNode.id, treeNode.pId, treeNode.name);
        }

        function onRename(e, treeId, treeNode, isCancel) {
            showLog((isCancel ? "<span style='color:red'>" : "") + "[ " + getTime() + " onRename ]&nbsp;&nbsp;&nbsp;&nbsp; " + treeNode.name + (isCancel ? "</span>" : ""));
        }
        function showRemoveBtn(treeId, treeNode) {
            return !treeNode.isFirstNode;
        }

        function showLog(str) {
            if (!log) log = $("#log");
            log.append("<li class='" + className + "'>" + str + "</li>");
            if (log.children("li").length > 8) {
                log.get(0).removeChild(log.children("li")[0]);
            }
        }
        function getTime() {
            var now = new Date(),
			h = now.getHours(),
			m = now.getMinutes(),
			s = now.getSeconds(),
			ms = now.getMilliseconds();
            return (h + ":" + m + ":" + s + " " + ms);
        }

        var newCount = 1;
        function addHoverDom(treeId, treeNode) {
            var sObj = $("#" + treeNode.tId + "_span");
            if (treeNode.editNameFlag || $("#addBtn_" + treeNode.tId).length > 0) return;
            var addStr = "<span class='button add' id='addBtn_" + treeNode.tId
				+ "' title='add node' onfocus='this.blur();'></span>";
            sObj.after(addStr);
            var btn = $("#addBtn_" + treeNode.tId);
            if (btn) btn.bind("click", function () {
                var zTree = $.fn.zTree.getZTreeObj("treeDemo");
                addWindow(treeNode.id);
                return false;
            });
        };

        function addWindow(parentId) {
            var windowH = $(window).height();
            var windowW = $(window).width();
            var offsetH = (windowH - 150) / 2;
            var offsetw = (windowW - 300) / 2;
            $("#windowMask").show();
            $("#windowDiv").css("top", offsetH).css("left", offsetw).show();
            $("#ParentId").val(parentId);
        }

        function editWindow(id,pid, name) {
            var windowH = $(window).height();
            var windowW = $(window).width();
            var offsetH = (windowH - 150) / 2;
            var offsetw = (windowW - 300) / 2;
            $("#windowMask").show();
            $("#windowDiv").css("top", offsetH).css("left", offsetw).show();
            $("#Id").val(id);
            $("#DeptName").val(name);
            $("#DeptCode").val("编码");
            $("#ParentId").val(pid);
        }

        function Add() {
            if ($("#Id").val() == "") {
                $.ajax({
                    url: "/SysDept/Add",
                    async: false,
                    data: { "ParentId": $("#ParentId").val(), "DeptCode": $("#DeptCode").val(), "DeptName": $("#DeptName").val() },
                    type: "post",
                    success: function (json) {
                        $("#windowDiv").hide();
                        $("#windowMask").hide();
                        $("#Id").val("");
                        $("#DeptName").val("");
                        $("#DeptCode").val("");
                        $("#ParentId").val("");
                        $.fn.zTree.init($("#treeDemo"), setting, getData());
                    }
                });
            } else {
                $.ajax({
                    url: "/SysDept/Update",
                    async: false,
                    data: { "ParentId": $("#ParentId").val(), "Id": $("#Id").val(), "DeptCode": $("#DeptCode").val(), "DeptName": $("#DeptName").val() },
                    type: "post",
                    success: function (json) {
                        $("#windowDiv").hide();
                        $("#windowMask").hide();
                        $("#Id").val("");
                        $("#DeptName").val("");
                        $("#DeptCode").val("");
                        $("#ParentId").val("");
                        $.fn.zTree.init($("#treeDemo"), setting, getData());
                    }
                });
            }
        }

        function selectAll() {
            var zTree = $.fn.zTree.getZTreeObj("treeDemo");
            zTree.setting.edit.editNameSelectAll = $("#selectAll").attr("checked");
        }

        $(document).ready(function () {
            $.fn.zTree.init($("#treeDemo"), setting, getData());
            $("#selectAll").bind("click", selectAll);
        });

        function Calse() {
            $("#Id").val("");
            $("#DeptName").val("");
            $("#DeptCode").val("");
            $("#ParentId").val("");
            $("#windowDiv").hide();
            $("#windowMask").hide();
        }
		//-->
    </script>
</head>

<body>
    <div class="content_wrap">
        <div class="zTreeDemoBackground left">
            <ul id="treeDemo" class="ztree"></ul>
        </div>
    </div>
</body>
</html>
<style type="text/css">
    .ztree li span.button.add {
        margin-left: 2px;
        margin-right: -1px;
        background-position: -144px 0;
        vertical-align: top;
        *vertical-align: middle;
    }

    #windowDiv {
        display: none;
        position: absolute;
        width: 300px;
        height: 150px;
        z-index: 3;
        background-color: #1E1E1E;
        border: 1px solid #9CDFCE;
        list-style: none;
        color: white;
    }


        #windowDiv li {
            list-style: none;
            text-align: center;
        }

    #windowMask {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        position: absolute;
        opacity: 0.5;
        background-color: black;
        display: none;
        z-index: 2;
    }
    .divSpace{
        height:5px;
    }
</style>


<div id="windowMask"></div>
<div id="windowDiv">
    <ul style=" top:30px;   position:relative;">
        <li>
            <input id="ParentId" type="hidden" />
            <input id="Id" type="hidden" />
            部门名称:<input id="DeptName" type="text" />
        </li>
        <li class="divSpace"></li>
        <li>
            部门编码:<input id="DeptCode" type="text" />
        </li>
        <li class="divSpace"></li>
        <li>
            <input id="btnAdd" type="button" value="保存" onclick="Add()" />
            &nbsp;  &nbsp;  &nbsp;  &nbsp;
            <input id="btnCalse" type="button" value="取消" onclick="Calse()" />
        </li>
    </ul>
</div>