@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/Content/bootstrap.css" rel="stylesheet" />
<script src="~/Content/zTree-zTree_v3-master/zTree_v3/js/jquery-1.4.4.min.js"></script>
<div style="width: 100%">
    <input id="btnAdd" name="btnAdd" type="button" value="添加" class="btn-success" onclick="openWindow()" />
    <table class="table">
        <thead>
            <tr>
                <td>编号</td>
                <td>名称</td>
                <td>授权</td>
            </tr>
        </thead>
        <tbody id="showRole"></tbody>
    </table>
</div>

<div id="windowMask"></div>
<div id="windowDiv">
    <ul style="top: 30px; position: relative;">
        <li>
            角色名称:<input id="RoleName" type="text" />
        </li>
        <li style="height: 5px;"></li>
        <li>
            <input id="btnSave" type="button" value="保存" onclick="save()" />
            &nbsp; &nbsp; &nbsp; &nbsp;
            <input id="btnCalse" type="button" value="取消" onclick="closeWindow()" />
        </li>
    </ul>
</div>
<script type="text/javascript">
    init();

    function init() {
        var strHtml = "";
        $.ajax({
            url: "/SysRole/GetList",
            async: false,
            type: "post",
            success: function (json) {
                if (json != null && json != undefined) {
                    for (var i = 0; i < json.length; i++) {
                        strHtml += "<tr>";
                        strHtml += "<td>" + json[i].Id + "</td>";
                        strHtml += "<td>" + json[i].RoleName + "</td>";
                        strHtml += '<td><a href="/Admin/SysTemplate/ActionTree?RoleId='+json[i].Id+'">授权</a></td>';
                        strHtml += "</tr>";
                    }
                }
            }
        });
        $("#showRole").html(strHtml);
    }
    function openWindow() {
        var windowH = $(window).height();
        var windowW = $(window).width();
        var offsetH = (windowH - 200) / 2;
        var offsetw = (windowW - 300) / 2;
        $("#windowMask").show();
        $("#windowDiv").css("top", offsetH).css("left", offsetw).show();
    }

    function save() {
        $.ajax({
            url: "/SysRole/Add",
            async: false,
            type: "post",
            data: { "RoleName": $("#RoleName").val() },
            success: function (json) {
                if (json != null && json != undefined) {
                    if (json.Flag) {
                        alert("保存成功");
                        init();
                        closeWindow();
                    } else {
                        alert(json.Message);
                    }
                }
            }
        });
    }

    function closeWindow() {
        $("#windowDiv").hide();
        $("#windowMask").hide();
        $("#RoleName").val("");
    }
</script>
<style type="text/css">
    .ztree li span.button.add {
        margin-left: 2px;
        margin-right: -1px;
        background-position: -144px 0;
        vertical-align: top;
        *vertical-align: middle;
    }

    #windowDiv {
        display: none;
        position: absolute;
        width: 300px;
        height: 200px;
        z-index: 3;
        background-color: #1E1E1E;
        border: 1px solid #9CDFCE;
        list-style: none;
        color: white;
    }

        #windowDiv li {
            list-style: none;
            text-align: center;
        }

    #windowMask {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        position: absolute;
        opacity: 0.5;
        background-color: black;
        display: none;
        z-index: 2;
    }
</style>
